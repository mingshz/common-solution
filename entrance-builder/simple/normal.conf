

server {
    listen       80;
    server_name  test.lmjia.cn;

    location / {
        proxy_pass http://localhost:20002;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Host $http_host;
    }
}

server {
    listen       80;
    server_name  app.lmjia.cn ali.lmjia.cn;

    location / {
        proxy_pass http://localhost:20000;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Host $http_host;
    }
}

server {
    listen 443;
    server_name app.lmjia.cn;
    ssl on;
#    root html;
#    index index.html index.htm;
    ssl_certificate   cert/app.lmjia.cn.pem;
    ssl_certificate_key  cert/app.lmjia.cn.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    location / {
#        root html;
#        index index.html index.htm;
        proxy_pass http://localhost:20000;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Host $http_host;
        # information from https://gist.github.com/micho/1712812
        proxy_set_header        X-Client-Verify  SUCCESS;
        proxy_set_header        X-Client-DN      $ssl_client_s_dn;
        proxy_set_header        X-SSL-Subject    $ssl_client_s_dn;
        proxy_set_header        X-SSL-Issuer     $ssl_client_i_dn;
        # wrire response header
        proxy_redirect http://app.lmjia.cn https://app.lmjia.cn;
    }
}



upstream tomcat {                      # 负载均衡站点的名称为tomcat，可以自己取
    # ip_hash;                           # 可选，根据来源IP方式选择web服务器，省略的话按默认的轮循方式选择web服务器
        server 10.26.115.160:20002;       # web服务器的IP地址及tomcat发布端口
        server 10.26.197.142:20002;
}
server {
    listen       80;                   # 站点侦听端口80
    server_name  ct.lmjia.cn;            # 站点名称

    location / {
        # root   html;
        # index  index.html index.htm;
        proxy_pass http://tomcat;      # 负载均衡指向的发布服务tomcat
    }
}